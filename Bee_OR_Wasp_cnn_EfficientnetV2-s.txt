from google.colab import drive

# Google Driveë¥¼ '/content/drive' ê²½ë¡œì— ë§ˆìš´íŠ¸í•©ë‹ˆë‹¤.
drive.mount('/content/drive')


import kagglehub
import shutil
import os

# 1. ëª©ì ì§€ ê²½ë¡œ ì„¤ì • (í˜„ì¬ í”„ë¡œì íŠ¸ ê²½ë¡œ/dataset)
target_path = os.path.join(os.getcwd(), "dataset")

# 2. ë°ì´í„°ì…‹ í´ë”ê°€ ì´ë¯¸ ìˆëŠ”ì§€ í™•ì¸
if os.path.exists(target_path):
    print(f"âœ… ì•Œë¦¼: '{target_path}' í´ë”ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.")
    print("ë‹¤ìš´ë¡œë“œë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.")
else:
    print("ğŸ“¥ ë°ì´í„°ì…‹ ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...")
    try:
        # ë‹¤ìš´ë¡œë“œ (ìºì‹œ ê²½ë¡œì— ì €ì¥ë¨)
        tmp_path = kagglehub.dataset_download("jerzydziewierz/bee-vs-wasp")
        print(f"ì„ì‹œ ì €ì¥ ê²½ë¡œ: {tmp_path}")

        # ì´ë™ (ì„ì‹œ ê²½ë¡œ -> ëª©ì ì§€ ê²½ë¡œ)
        shutil.move(tmp_path, target_path)
        print(f"âœ… ì„±ê³µ: ë°ì´í„°ë¥¼ {target_path}ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤.")
        
    except Exception as e:
        print(f"âŒ ì˜¤ë¥˜ ë°œìƒ: {e}")


import os
import shutil

# 1. ê²½ë¡œ ì„¤ì •
base_path = os.path.join(os.getcwd(), "dataset")
source_root = os.path.join(base_path, "kaggle_bee_vs_wasp") # ì´ë¯¸ì§€ì— ë³´ì´ëŠ” ë‚´ë¶€ í´ë”

# ì´ë™ ê·œì¹™ ì •ì˜ (ëª©í‘œ í´ë”ëª… : [ê°€ì ¸ì˜¬ ì†ŒìŠ¤ í´ë” ë¦¬ìŠ¤íŠ¸])
move_rules = {
    "bee": ["bee1", "bee2"],
    "wasp": ["wasp1", "wasp2"],
    "other_insect": ["other_insect"]
}

print("ğŸ“‚ ë°ì´í„°ì…‹ ì •ë¦¬ ì‹œì‘...")

# 2. íŒŒì¼ ì´ë™ ë¡œì§
for target_name, source_list in move_rules.items():
    # ëª©í‘œ í´ë” ìƒì„± (ì˜ˆ: dataset/bee)
    target_dir = os.path.join(base_path, target_name)
    os.makedirs(target_dir, exist_ok=True)
    
    count = 0
    for source_name in source_list:
        source_dir = os.path.join(source_root, source_name)
        
        # ì†ŒìŠ¤ í´ë”ê°€ ìˆëŠ”ì§€ í™•ì¸
        if os.path.exists(source_dir):
            files = os.listdir(source_dir)
            for file_name in files:
                src_file = os.path.join(source_dir, file_name)
                dst_file = os.path.join(target_dir, file_name)
                
                # íŒŒì¼ ì´ë™
                shutil.move(src_file, dst_file)
                count += 1
            
            # ë‹¤ ì˜®ê¸´ ë¹ˆ ì†ŒìŠ¤ í´ë” ì‚­ì œ (ì„ íƒì‚¬í•­)
            try:
                os.rmdir(source_dir)
            except:
                pass # ë¹„ì–´ìˆì§€ ì•Šìœ¼ë©´ íŒ¨ìŠ¤
                
    print(f"âœ… '{target_name}' í´ë”ë¡œ {count}ê°œ íŒŒì¼ ì´ë™ ì™„ë£Œ.")

# 3. (ì˜µì…˜) ê»ë°ê¸°ë§Œ ë‚¨ì€ kaggle_bee_vs_wasp í´ë” ì •ë¦¬
# í•„ìš” ì—†ìœ¼ì‹œë©´ ì•„ë˜ ì£¼ì„ì„ í•´ì œí•˜ì—¬ ì‚­ì œí•˜ì„¸ìš”
# shutil.rmtree(source_root) 

print("ğŸ‰ ì „ì²´ ì •ë¦¬ ì™„ë£Œ!")



# ë°ì´í„°ì…‹ ë¶„í•  ì½”ë“œ (Train/Val Split)

import os
import shutil
import random

# 1. ì„¤ì •
base_path = os.path.join(os.getcwd(), "dataset")
classes = ["bee", "wasp", "other_insect"]
val_ratio = 0.2  # ê²€ì¦ ë°ì´í„° ë¹„ìœ¨ (20%)

# ëœë¤ ì‹œë“œ ê³ ì • (ë§¤ë²ˆ ë˜‘ê°™ì´ ì„ì´ë„ë¡ - ì¬í˜„ì„± í™•ë³´)
random.seed(42)

print(f"ğŸ”„ ë°ì´í„° ë¶„í•  ì‹œì‘ (Validation ë¹„ìœ¨: {val_ratio * 100}%)")

for cls in classes:
    # í˜„ì¬ í´ë˜ìŠ¤ í´ë” ê²½ë¡œ (ì˜ˆ: dataset/bee)
    src_dir = os.path.join(base_path, cls)
    
    # ì†ŒìŠ¤ í´ë”ê°€ ì—†ìœ¼ë©´ ê±´ë„ˆëœ€ (ì´ë¯¸ ì‹¤í–‰í–ˆê±°ë‚˜ í´ë”ëª…ì´ í‹€ë¦° ê²½ìš°)
    if not os.path.exists(src_dir):
        print(f"âš ï¸ ê²½ê³ : '{src_dir}' í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê±´ë„ˆëœë‹ˆë‹¤.")
        continue

    # ì´ë¯¸ì§€ íŒŒì¼ ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
    files = [f for f in os.listdir(src_dir) if f.lower().endswith(('.png', '.jpg', '.jpeg'))]
    random.shuffle(files) # íŒŒì¼ ìˆœì„œ ì„ê¸°

    # ë¶„í•  ì§€ì  ê³„ì‚°
    split_idx = int(len(files) * val_ratio)
    val_files = files[:split_idx]
    train_files = files[split_idx:]

    print(f"   ğŸ“‚ {cls}: ì „ì²´ {len(files)}ì¥ -> Train {len(train_files)}ì¥ / Val {len(val_files)}ì¥")

    # 2. ì´ë™ í•¨ìˆ˜ ì •ì˜
    def move_files(file_list, split_name):
        dest_dir = os.path.join(base_path, split_name, cls)
        os.makedirs(dest_dir, exist_ok=True) # í´ë”ê°€ ì—†ìœ¼ë©´ ìƒì„±
        
        for f in file_list:
            shutil.move(os.path.join(src_dir, f), os.path.join(dest_dir, f))

    # 3. íŒŒì¼ ì´ë™ ì‹¤í–‰
    move_files(val_files, "val")
    move_files(train_files, "train")

    # 4. ë¹ˆ ì›ë³¸ í´ë” ì‚­ì œ (dataset/bee ë“±)
    try:
        os.rmdir(src_dir)
    except OSError:
        print(f"   â„¹ï¸ ì•Œë¦¼: {src_dir} í´ë”ì— ì”ì—¬ íŒŒì¼ì´ ìˆì–´ ì‚­ì œí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")

print("âœ… ëª¨ë“  ì‘ì—… ì™„ë£Œ! ë°ì´í„°ì…‹ì´ Train/Valë¡œ ë¶„ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.")